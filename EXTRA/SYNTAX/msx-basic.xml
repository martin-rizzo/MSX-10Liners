<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE language SYSTEM "language.dtd">
<language name="MSX-BASIC"
          section="Sources" 
          version="4"
          kateversion="5.0"
          extensions="*.bas;*.asc"
          priority="10"
          indenter="normal"
          author="Martin Rizzo (martinrizzo@gmail.com)"
          >

<!-- 

  Documentation:
      https://docs.kde.org/stable5/en/applications/katepart/highlight.html

-->
          
  <highlighting>
  
      <list name="instructions">
      <item>DATA</item>
      <item>DEFINT</item>
      <item>SCREEN</item>
    </list>

    <contexts>
    
      <context name="Normal" attribute="Unnumbered Line" lineEndContext="#stay">
          <RegExpr String="[0-9]{6,}"  attribute="Error"        context="Statements"   />
          <RegExpr String="[0-9]{0,5}" attribute="Line Number"  context="Statements"   />
      </context>


      
      
      <context name="Statements" attribute="Normal" lineEndContext="#pop" >
        <DetectChar char=":" attribute="Line Separator" context="#pop" />
        <IncludeRules context="Commands" />
        <RegExpr String="[A-Z]"  lookAhead="true"  context="Assignment" />
        <RegExpr String="[^\s:]" attribute="Error" context="#stay" />
      </context>
      
      <context name="No Command" attribute="Normal" lineEndContext="#pop" >
        <DetectChar char=":" attribute="Line Separator" context="#pop" />

      </context>
      
      
        
      

<!--
==============================================================================================
                               COMMANDS AND FUNCTIONS
==============================================================================================
-->

      <!-- COMMANDS -->
      <context name="Commands" >
        <StringDetect String="BEEP"   attribute="Command" context="Line Finished"      insensitive="true" />
        <StringDetect String="BLOAD"  attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="BSAVE"  attribute="Command" context="Command Parameters" insensitive="true" />
        <!-- CALL -->
        <StringDetect String="CIRCLE" attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="CLEAR"  attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="CLOAD"  attribute="Command" context="Command Parameters" insensitive="true" />
        <!-- CLOAD? -->
        <StringDetect String="CLOSE"  attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="CLS"    attribute="Command" context="Line Finished"      insensitive="true" />
        <StringDetect String="COLOR"  attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="CSAVE"  attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="DATA"   attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="DEFDBL" attribute="Command" context="Range of Letters"   insensitive="true" />
        <StringDetect String="DEFINT" attribute="Command" context="Range of Letters"   insensitive="true" />
        <StringDetect String="DEFSNG" attribute="Command" context="Range of Letters"   insensitive="true" />
        <StringDetect String="DEFSTR" attribute="Command" context="Range of Letters"   insensitive="true" />
        <StringDetect String="DIM"    attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="DRAW"   attribute="Command" context="String Parameter"   insensitive="true" />
        <!-- END (flow control) -->
        <StringDetect String="ERASE"  attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="ERROR"  attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="FILES"  attribute="Command" context="Command Parameters" insensitive="true" />
        <!-- FN -->
        <StringDetect String="GOTO"   attribute="Ctrl Flow" context="Dest Number Line"   insensitive="true" />
        <StringDetect String="GOSUB"  attribute="Ctrl Flow" context="Dest Number Line"   insensitive="true" />
        <StringDetect String="INPUT"  attribute="Command"   context="Command Parameters" insensitive="true" />
        <!-- INPUT# -->
        <StringDetect String="INTERVAL" attribute="Command" context="On Off Stop"    insensitive="true" />
        <StringDetect String="KEY"      attribute="Command" context="Key Parameters" insensitive="true" />
        <StringDetect String="LET"      attribute="Command" context="Assignment"     insensitive="true" />
        
        
        
        
        <StringDetect String="RESUME"   attribute="Command" context="Dest Number Line|Next" insensitive="true" /> 
        <StringDetect String="RUN"      attribute="Command" context="Command Parameter"  insensitive="true" />
        <StringDetect String="SAVE"     attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="SCREEN"   attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="SOUND"    attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="SPRITE"   attribute="Command" context="On Off Stop"        insensitive="true" />
        <StringDetect String="STOP"     attribute="Command" context="On Off Stop"        insensitive="true" />
        <StringDetect String="STRIG("   attribute="Command" context="Index On Off Stop"  insensitive="true" />
        <StringDetect String="SWAP"     attribute="Command" context="Var Parameters"     insensitive="true" />
        <StringDetect String="TROFF"    attribute="Command" context="Line Finished"      insensitive="true" />
        <StringDetect String="TRON"     attribute="Command" context="Line Finished"      insensitive="true" />
        <StringDetect String="VPOKE"    attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="WAIT"     attribute="Command" context="Command Parameters" insensitive="true" />
        <StringDetect String="WIDTH"    attribute="Command" context="Integer Parameter"  insensitive="true" />
      </context>
        <!--
        
LET			MSX1		
LINE			MSX1	MSX2	
LINE INPUT		MSX1		
LIST			MSX1		
LLIST			MSX1		
LOAD			MSX1		
LOCATE			MSX1		
LPOS()			MSX1		
LPRINT			MSX1		
MERGE			MSX1		
MID$()			MSX1		
MOTOR			MSX1		
NEW			MSX1		
ON...GOSUB		MSX1		
ON...GOTO		MSX1		
ON ERROR GOTO		MSX1		
ON INTERVAL GOSUB	MSX1		
ON KEY GOSUB		MSX1		
ON SPRITE GOSUB		MSX1		
ON STOP GOSUB		MSX1		
ON STRIG GOSUB		MSX1		
OPEN			MSX1		
OUT			MSX1		
PAINT			MSX1		
PLAY			MSX1		
PLAY()			MSX1		
POINT			MSX1		
POKE			MSX1		
PRESET			MSX1	MSX2	
PRINT			MSX1		
PSET			MSX1	MSX2	
PUT SPRITE		MSX1	MSX2	
READ			MSX1		
REM			MSX1		
RENUM			MSX1		
RESTORE			MSX1		
RESUME			MSX1		
RUN			MSX1		
        
        -->
        
        
        
      
      <!-- FUNCTIONS -->
      <context name="Functions" lineEndContext="#pop" >
          <StringDetect String="ABS(" attribute="Function" context="#stay" insensitive="true" /> 
      </context>
      
      
      

<!--
==============================================================================================
                                   PARAMETERS
==============================================================================================
-->
      
      <!-- NO PARAMETERS -->
      <context name="No Parameters" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=":" attribute="Line Separator" context="#pop" />
          <RegExpr String="\S+" attribute="Error" context="#stay" />
      </context>
      
      <!-- STRING PARAMETER -->
      <context name="String Parameter" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=":" attribute="Line Separator" context="#pop" />
      </context>
      
      <!-- INTEGER PARAMETER -->
      <context name="Integer Parameter" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=":" attribute="Line Separator" context="#pop" />
          <IncludeRules context="Expression" />
      </context>
      
      <!-- VAR PARAMETERS (MULTIPLE PARAMETERS BUT ALL OF THEM ARE VARIABLE NAMES) -->
      <context name="Var Parameters" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=":"            attribute="Line Separator" context="#pop"                                    />
          <DetectChar char=","            attribute="Normal"         context="#stay"                                   />
          <RegExpr    String="[A-Z]"      attribute="Variable"       context="Inside Variable Name" insensitive="true" />
          <RegExpr    String="[^\s:,]+"   attribute="Error"          context="#stay"                                   />
      </context>
      
      <!-- KEY PARAMETERS -->
      <context name="Key Parameters" attribute="Normal" lineEndContext="#pop" >
          <DetectChar   char=":"  attribute="Line Separator" context="#pop" />
          <StringDetect String="ON"      attribute="Normal"   context="#stay" insensitive="true" />
          <StringDetect String="OFF"     attribute="Normal"   context="#stay" insensitive="true" />
          <StringDetect String="LIST"    attribute="Normal"   context="#stay" insensitive="true" />
          <DetectChar   char="("         attribute="Command"  context="#pop!Index On Off Stop"   />
          <RegExpr      String="[0-9]+"  attribute="Normal"   context="#pop!Command Parameters"  />
          <RegExpr      String="[^\s:]+" attribute="Error"    context="#stay" />
      </context>
      
      <!-- COMMAND PARAMETER (ONLY ONE PARAMETER) -->
      <context name="Command Parameter" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=":" attribute="Line Separator"   context="#pop" />
          <DetectChar char="," attribute="Error"            context="#pop!Fatal Error" />
          <IncludeRules context="Expression" />
      </context>
      
      <!-- COMMAND PARAMETERS (MULTIPLE PARAMETERS) -->
      <context name="Command Parameters" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=":" attribute="Line Separator"      context="#pop"  />
          <DetectChar char="," attribute="Parameter Separator" context="#stay" />
          <IncludeRules context="Expression" />
      </context>
      
      <!-- FUNCTION PARAMETERS -->
      <context name="Function Parameters" lineEndContext="#pop" >
          <DetectChar char=")" attribute="Function" context="#pop"  />
          <IncludeRules context="Command Parameters" />
      </context>
      
      <!-- ON / OFF / STOP PARAMETERS -->
      <context name="On Off Stop" attribute="Normal" lineEndContext="#pop" >
          <DetectChar   char=":"         attribute="Line Separator" context="#pop" />
          <StringDetect String="ON"      attribute="Constant"       context="#stay" insensitive="true" />
          <StringDetect String="OFF"     attribute="Constant"       context="#stay" insensitive="true" />
          <StringDetect String="STOP"    attribute="Constant"       context="#stay" insensitive="true" />
          <RegExpr      String="[^\s:]+" attribute="Error"          context="#stay" />
      </context>
      
      <!-- (INDEX) ON / OFF / STOP PARAMETERS -->
      <context name="Index On Off Stop" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=")" attribute="Command" context="#pop!On Off Stop" />
          <IncludeRules context="Expression" />
      </context>
      
      <!-- DESTINATION NUMBER LINE (AS THE ONLY PARAMETER) -->
      <context name="Dest Number Line" attribute="Normal" lineEndContext="#pop"  >
          <RegExpr String="[0-9]{6,}"  attribute="Error"       context="#pop!Fatal Error" />
          <RegExpr String="[0-9]{0,5}" attribute="Line Number" context="#pop!Line Finished" />
          <RegExpr String="[^\s:]+"    attribute="Error"       context="#pop!Fatal Error" />
      </context>
      
      <!-- DESTINATION NUMBER LINE OR "NEXT" (AS THE ONLY PARAMETER) -->
      <context name="Dest Number Line|Next" attribute="Normal" lineEndContext="#pop" >
          <StringDetect String="NEXT" attribute="Constant" context="#pop!Line Finished" insensitive="true" />
          <IncludeRules context="Dest Number Line" />
      </context>
      
      <!-- RANGE OF LETTERS PARAMETERS (EXAMPLE: I-N,W-Z) -->
      <context name="Range of Letters" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=":" attribute="Line Separator" context="#pop"  />
          <DetectChar char="-" attribute="Operator" context="#stay" />
          <AnyChar String="ABCDEFGHIJKLMNOPQRSTUVWXYZ" attribute="Char" context="#stay" />
      </context>
      
<!--
==============================================================================================
                                   EXPRESSIONS
==============================================================================================
-->
      
      <!-- OPERATORS -->
      <context name="Operators" >
          <!-- arithmetic & conditions -->
          <AnyChar String="+-*/^\=&lt;&gt;" attribute="Operator" context="#stay" />
          <StringDetect String="MOD" attribute="Operator" context="#stay" insensitive="true" />
          <!-- logical -->
          <StringDetect String="AND" attribute="Operator" context="#stay" insensitive="true" />
          <StringDetect String="EQV" attribute="Operator" context="#stay" insensitive="true" />
          <StringDetect String="IMP" attribute="Operator" context="#stay" insensitive="true" />
          <StringDetect String="NOT" attribute="Operator" context="#stay" insensitive="true" />
          <StringDetect String="OR"  attribute="Operator" context="#stay" insensitive="true" />
          <StringDetect String="XOR" attribute="Operator" context="#stay" insensitive="true" />
      </context>
      
      <!-- EXPRESSION -->
      <context name="Expression" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=":" attribute="Line Separator" context="#pop" />
          <IncludeRules context="Operators" />
          <RegExpr    String="[+-]?[0-9]*\.?[0-9]+([EeDd][-+]?[0-9]+)?[#!]?" attribute="Number"   context="#stay"                />
          <RegExpr    String="[A-Z]"                                         attribute="Variable" context="Inside Variable Name" />
          <RegExpr    String="[a-zA-Z][a-zA-Z0-9]{0,30}\("                   attribute="Function" context="Function Parameters"  />
          <DetectChar char='"'                                               attribute="String"   context="Inside String"        />
      </context>
      
      <!-- ASSIGNMENT -->
      <context name="Assignment" attribute="Normal" lineEndContext="#pop" >
           <DetectChar char=":"         attribute="Error"    context="#pop"                                    />
           <RegExpr    String="[A-Z]"   attribute="Variable" context="Inside Variable Name" insensitive="true" />
           <DetectChar char="="         attribute="Operator" context="#pop!Expression"                         />
           <RegExpr    String="[^\s:]+" attribute="Error"    context="#stay"                                   />
      </context>
      
      <!-- INSIDE A VARIABLE NAME -->
      <context name="Inside Variable Name" attribute="Normal" lineEndContext="#pop" fallthrough="true" fallthroughContext="#pop" >
          <RegExpr String="[A-Z0-9]*[$%!#]?" attribute="Variable" context="#stay" insensitive="true" />
          <DetectChar char="(" attribute="Variable" context="#pop!Inside Array Subscript" />
      </context>
      
      <!-- INSIDE AN ARRAY SUBSCRIPT -->
      <context name="Inside Array Subscript" attribute="Normal" lineEndContext="#pop" >
          <DetectChar char=")" attribute="Variable" context="#pop" />
          <IncludeRules context="Expression" />
      </context>
      
      <!-- INSIDE A STRING -->
      <context name="Inside String" attribute="String" lineEndContext="#pop" >
          <DetectChar char='"' attribute="String" context="#pop" />
      </context>
      
<!--
==============================================================================================
                                     SPECIAL
==============================================================================================
-->
      
      <!-- LINE FINISHED -->
      <context name="Line Finished" attribute="Normal Text" lineEndContext="#pop" >
          <DetectChar char=":"         attribute="Line Separator" context="#pop"  />
          <RegExpr    String="[^\s:]+" attribute="Error"          context="#stay" />
      </context>
      
      <!-- FATAL ERROR -->
      <context name="Fatal Error" attribute="Error" lineEndContext="#pop" >
          <DetectChar char=":" attribute="Line Separator" context="#pop" />
      </context>
      

    </contexts>
    <itemDatas>
      <itemData name="Char"                defStyleNum="dsChar"         />
      <itemData name="Command"             defStyleNum="dsBuiltIn"      />
      <itemData name="Keyword"             defStyleNum="dsKeyword"      />
      <itemData name="Operator"            defStyleNum="dsOperator"     />
      <itemData name="Number"              defStyleNum="dsDecVal"       />
      <itemData name="Variable"            defStyleNum="dsVariable"     />
      <itemData name="Constant"            defStyleNum="dsConstant"     />
      <itemData name="Function"            defStyleNum="dsFunction"     />
      <itemData name="Ctrl Flow"           defStyleNum="dsControlFlow"  />
      <itemData name="Line Number"         defStyleNum="dsPreprocessor" />
      <itemData name="Line Separator"      defStyleNum="dsPreprocessor" bold="true" />
      <itemData name="Parameter Separator" defStyleNum="dsNormal"       />
      
      <itemData name="Unnumbered Line" defStyleNum="dsNormal" />
      <itemData name="Error"           defStyleNum="dsError" />
    
      <itemData name="Normal"       defStyleNum="dsNormal"  />
      <itemData name="Statements" defStyleNum="dsNormal" />
      <itemData name="Normal Text" defStyleNum="dsNormal"  />
      <itemData name="Code"        defStyleNum="dsNormal"  />
      <itemData name="Hex"         defStyleNum="dsBaseN"   />
      <itemData name="String"      defStyleNum="dsString" />
      <itemData name="Comment"     defStyleNum="dsComment" />
    </itemDatas>
  </highlighting>
  <general>
    <keywords casesensitive="false" />
  </general>
</language>
<!-- kate: replace-tabs on; tab-width 2 -->
